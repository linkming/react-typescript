{"ast":null,"code":"const Util = require('../util/common');\n\nconst MatrixUtil = require('./util/matrix');\n\nconst Vector2 = require('./util/vector2');\n\nconst StyleUtil = require('./util/style-parse');\n\nfunction isUnchanged(m) {\n  return m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 1 && m[4] === 0 && m[5] === 0;\n}\n\nconst ALIAS_ATTRS_MAP = {\n  stroke: 'strokeStyle',\n  fill: 'fillStyle',\n  opacity: 'globalAlpha'\n};\nconst SHAPE_ATTRS = ['fillStyle', 'font', 'globalAlpha', 'lineCap', 'lineWidth', 'lineJoin', 'miterLimit', 'shadowBlur', 'shadowColor', 'shadowOffsetX', 'shadowOffsetY', 'strokeStyle', 'textAlign', 'textBaseline', 'lineDash', 'shadow' // 兼容支付宝小程序\n];\nconst CLIP_SHAPES = ['circle', 'sector', 'polygon', 'rect', 'polyline'];\n\nclass Element {\n  _initProperties() {\n    this._attrs = {\n      zIndex: 0,\n      visible: true,\n      destroyed: false\n    };\n  }\n\n  constructor(cfg) {\n    this._initProperties();\n\n    Util.mix(this._attrs, cfg);\n    const attrs = this._attrs.attrs;\n\n    if (attrs) {\n      this.initAttrs(attrs);\n    }\n\n    this.initTransform();\n  }\n\n  get(name) {\n    return this._attrs[name];\n  }\n\n  set(name, value) {\n    this._attrs[name] = value;\n  }\n\n  isGroup() {\n    return this.get('isGroup');\n  }\n\n  isShape() {\n    return this.get('isShape');\n  }\n\n  initAttrs(attrs) {\n    this.attr(Util.mix(this.getDefaultAttrs(), attrs));\n  }\n\n  getDefaultAttrs() {\n    return {};\n  }\n\n  _setAttr(name, value) {\n    const attrs = this._attrs.attrs;\n\n    if (name === 'clip') {\n      value = this._setAttrClip(value);\n    } else {\n      const alias = ALIAS_ATTRS_MAP[name];\n\n      if (alias) {\n        attrs[alias] = value;\n      }\n    }\n\n    attrs[name] = value;\n  }\n\n  _getAttr(name) {\n    return this._attrs.attrs[name];\n  } // _afterAttrsSet() {}\n\n\n  _setAttrClip(clip) {\n    if (clip && CLIP_SHAPES.indexOf(clip._attrs.type) > -1) {\n      if (clip.get('canvas') === null) {\n        clip = Object.assign({}, clip);\n      }\n\n      clip.set('parent', this.get('parent'));\n      clip.set('context', this.get('context'));\n      return clip;\n    }\n\n    return null;\n  }\n\n  attr(name, value) {\n    const self = this;\n    if (self.get('destroyed')) return null;\n    const argumentsLen = arguments.length;\n\n    if (argumentsLen === 0) {\n      return self._attrs.attrs;\n    }\n\n    if (Util.isObject(name)) {\n      this._attrs.bbox = null;\n\n      for (const k in name) {\n        self._setAttr(k, name[k]);\n      }\n\n      if (self._afterAttrsSet) {\n        self._afterAttrsSet();\n      }\n\n      return self;\n    }\n\n    if (argumentsLen === 2) {\n      this._attrs.bbox = null;\n\n      self._setAttr(name, value);\n\n      if (self._afterAttrsSet) {\n        self._afterAttrsSet();\n      }\n\n      return self;\n    }\n\n    return self._getAttr(name);\n  }\n\n  getParent() {\n    return this.get('parent');\n  }\n\n  draw(context) {\n    if (this.get('destroyed')) {\n      return;\n    }\n\n    if (this.get('visible')) {\n      this.setContext(context);\n      this.drawInner(context);\n      this.restoreContext(context);\n    }\n  }\n\n  setContext(context) {\n    const clip = this._attrs.attrs.clip;\n    context.save();\n\n    if (clip) {\n      clip.resetTransform(context);\n      clip.createPath(context);\n      context.clip();\n    }\n\n    this.resetContext(context);\n    this.resetTransform(context);\n  }\n\n  restoreContext(context) {\n    context.restore();\n  }\n\n  resetContext(context) {\n    const elAttrs = this._attrs.attrs;\n\n    if (!this._attrs.isGroup) {\n      for (const k in elAttrs) {\n        if (SHAPE_ATTRS.indexOf(k) > -1) {\n          let v = elAttrs[k];\n\n          if (k === 'fillStyle' || k === 'strokeStyle') {\n            v = StyleUtil.parseStyle(v, this, context);\n          }\n\n          if (k === 'lineDash' && context.setLineDash && Util.isArray(v)) {\n            context.setLineDash(v);\n          } else {\n            context[k] = v;\n          }\n        }\n      }\n    }\n  }\n\n  hasFill() {\n    return this.get('canFill') && this._attrs.attrs.fillStyle;\n  }\n\n  hasStroke() {\n    return this.get('canStroke') && this._attrs.attrs.strokeStyle;\n  }\n\n  drawInner()\n  /* context */\n  {}\n\n  show() {\n    this.set('visible', true);\n    return this;\n  }\n\n  hide() {\n    this.set('visible', false);\n    return this;\n  }\n\n  isVisible() {\n    return this.get('visible');\n  }\n\n  _removeFromParent() {\n    const parent = this.get('parent');\n\n    if (parent) {\n      const children = parent.get('children');\n      Util.Array.remove(children, this);\n    }\n\n    return this;\n  }\n\n  remove(destroy) {\n    if (destroy) {\n      this.destroy();\n    } else {\n      this._removeFromParent();\n    }\n  }\n\n  destroy() {\n    const destroyed = this.get('destroyed');\n\n    if (destroyed) {\n      return null;\n    }\n\n    this._removeFromParent();\n\n    this._attrs = {};\n    this.set('destroyed', true);\n  }\n\n  getBBox() {\n    return {\n      minX: 0,\n      maxX: 0,\n      minY: 0,\n      maxY: 0,\n      width: 0,\n      height: 0\n    };\n  }\n\n  initTransform() {\n    const attrs = this._attrs.attrs || {};\n\n    if (!attrs.matrix) {\n      attrs.matrix = [1, 0, 0, 1, 0, 0];\n    }\n\n    this._attrs.attrs = attrs;\n  }\n\n  getMatrix() {\n    return this._attrs.attrs.matrix;\n  }\n\n  setMatrix(m) {\n    this._attrs.attrs.matrix = [m[0], m[1], m[2], m[3], m[4], m[5]];\n  }\n\n  transform(actions) {\n    const matrix = this._attrs.attrs.matrix;\n    this._attrs.attrs.matrix = MatrixUtil.transform(matrix, actions);\n    return this;\n  }\n\n  setTransform(actions) {\n    this._attrs.attrs.matrix = [1, 0, 0, 1, 0, 0];\n    return this.transform(actions);\n  }\n\n  translate(x, y) {\n    const matrix = this._attrs.attrs.matrix;\n    MatrixUtil.translate(matrix, matrix, [x, y]);\n  }\n\n  rotate(rad) {\n    const matrix = this._attrs.attrs.matrix;\n    MatrixUtil.rotate(matrix, matrix, rad);\n  }\n\n  scale(sx, sy) {\n    const matrix = this._attrs.attrs.matrix;\n    MatrixUtil.scale(matrix, matrix, [sx, sy]);\n  }\n\n  moveTo(x, y) {\n    const cx = this._attrs.x || 0;\n    const cy = this._attrs.y || 0;\n    this.translate(x - cx, y - cy);\n    this.set('x', x);\n    this.set('y', y);\n  }\n\n  apply(v) {\n    const m = this._attrs.attrs.matrix;\n    Vector2.transformMat2d(v, v, m);\n    return this;\n  }\n\n  resetTransform(context) {\n    const mo = this._attrs.attrs.matrix;\n\n    if (!isUnchanged(mo)) {\n      context.transform(mo[0], mo[1], mo[2], mo[3], mo[4], mo[5]);\n    }\n  }\n\n  isDestroyed() {\n    return this.get('destroyed');\n  }\n\n}\n\nmodule.exports = Element;","map":{"version":3,"sources":["/home/sunxuming/react-typescript/node_modules/_@antv_f2@3.6.0-alpha.2@@antv/f2/src/graphic/element.js"],"names":["Util","require","MatrixUtil","Vector2","StyleUtil","isUnchanged","m","ALIAS_ATTRS_MAP","stroke","fill","opacity","SHAPE_ATTRS","CLIP_SHAPES","Element","_initProperties","_attrs","zIndex","visible","destroyed","constructor","cfg","mix","attrs","initAttrs","initTransform","get","name","set","value","isGroup","isShape","attr","getDefaultAttrs","_setAttr","_setAttrClip","alias","_getAttr","clip","indexOf","type","Object","assign","self","argumentsLen","arguments","length","isObject","bbox","k","_afterAttrsSet","getParent","draw","context","setContext","drawInner","restoreContext","save","resetTransform","createPath","resetContext","restore","elAttrs","v","parseStyle","setLineDash","isArray","hasFill","fillStyle","hasStroke","strokeStyle","show","hide","isVisible","_removeFromParent","parent","children","Array","remove","destroy","getBBox","minX","maxX","minY","maxY","width","height","matrix","getMatrix","setMatrix","transform","actions","setTransform","translate","x","y","rotate","rad","scale","sx","sy","moveTo","cx","cy","apply","transformMat2d","mo","isDestroyed","module","exports"],"mappings":"AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAC,gBAAD,CAApB;;AACA,MAAMC,UAAU,GAAGD,OAAO,CAAC,eAAD,CAA1B;;AACA,MAAME,OAAO,GAAGF,OAAO,CAAC,gBAAD,CAAvB;;AACA,MAAMG,SAAS,GAAGH,OAAO,CAAC,oBAAD,CAAzB;;AAEA,SAASI,WAAT,CAAqBC,CAArB,EAAwB;AACtB,SAAOA,CAAC,CAAC,CAAD,CAAD,KAAS,CAAT,IAAcA,CAAC,CAAC,CAAD,CAAD,KAAS,CAAvB,IAA4BA,CAAC,CAAC,CAAD,CAAD,KAAS,CAArC,IAA0CA,CAAC,CAAC,CAAD,CAAD,KAAS,CAAnD,IAAwDA,CAAC,CAAC,CAAD,CAAD,KAAS,CAAjE,IAAsEA,CAAC,CAAC,CAAD,CAAD,KAAS,CAAtF;AACD;;AAED,MAAMC,eAAe,GAAG;AACtBC,EAAAA,MAAM,EAAE,aADc;AAEtBC,EAAAA,IAAI,EAAE,WAFgB;AAGtBC,EAAAA,OAAO,EAAE;AAHa,CAAxB;AAMA,MAAMC,WAAW,GAAG,CAClB,WADkB,EAElB,MAFkB,EAGlB,aAHkB,EAIlB,SAJkB,EAKlB,WALkB,EAMlB,UANkB,EAOlB,YAPkB,EAQlB,YARkB,EASlB,aATkB,EAUlB,eAVkB,EAWlB,eAXkB,EAYlB,aAZkB,EAalB,WAbkB,EAclB,cAdkB,EAelB,UAfkB,EAgBlB,QAhBkB,CAgBT;AAhBS,CAApB;AAmBA,MAAMC,WAAW,GAAG,CAAE,QAAF,EAAY,QAAZ,EAAsB,SAAtB,EAAiC,MAAjC,EAAyC,UAAzC,CAApB;;AAEA,MAAMC,OAAN,CAAc;AACZC,EAAAA,eAAe,GAAG;AAChB,SAAKC,MAAL,GAAc;AACZC,MAAAA,MAAM,EAAE,CADI;AAEZC,MAAAA,OAAO,EAAE,IAFG;AAGZC,MAAAA,SAAS,EAAE;AAHC,KAAd;AAKD;;AAEDC,EAAAA,WAAW,CAACC,GAAD,EAAM;AACf,SAAKN,eAAL;;AACAd,IAAAA,IAAI,CAACqB,GAAL,CAAS,KAAKN,MAAd,EAAsBK,GAAtB;AAEA,UAAME,KAAK,GAAG,KAAKP,MAAL,CAAYO,KAA1B;;AACA,QAAIA,KAAJ,EAAW;AACT,WAAKC,SAAL,CAAeD,KAAf;AACD;;AAED,SAAKE,aAAL;AACD;;AAEDC,EAAAA,GAAG,CAACC,IAAD,EAAO;AACR,WAAO,KAAKX,MAAL,CAAYW,IAAZ,CAAP;AACD;;AAEDC,EAAAA,GAAG,CAACD,IAAD,EAAOE,KAAP,EAAc;AACf,SAAKb,MAAL,CAAYW,IAAZ,IAAoBE,KAApB;AACD;;AAEDC,EAAAA,OAAO,GAAG;AACR,WAAO,KAAKJ,GAAL,CAAS,SAAT,CAAP;AACD;;AAEDK,EAAAA,OAAO,GAAG;AACR,WAAO,KAAKL,GAAL,CAAS,SAAT,CAAP;AACD;;AAEDF,EAAAA,SAAS,CAACD,KAAD,EAAQ;AACf,SAAKS,IAAL,CAAU/B,IAAI,CAACqB,GAAL,CAAS,KAAKW,eAAL,EAAT,EAAiCV,KAAjC,CAAV;AACD;;AAEDU,EAAAA,eAAe,GAAG;AAChB,WAAO,EAAP;AACD;;AAEDC,EAAAA,QAAQ,CAACP,IAAD,EAAOE,KAAP,EAAc;AACpB,UAAMN,KAAK,GAAG,KAAKP,MAAL,CAAYO,KAA1B;;AACA,QAAII,IAAI,KAAK,MAAb,EAAqB;AACnBE,MAAAA,KAAK,GAAG,KAAKM,YAAL,CAAkBN,KAAlB,CAAR;AACD,KAFD,MAEO;AACL,YAAMO,KAAK,GAAG5B,eAAe,CAACmB,IAAD,CAA7B;;AACA,UAAIS,KAAJ,EAAW;AACTb,QAAAA,KAAK,CAACa,KAAD,CAAL,GAAeP,KAAf;AACD;AACF;;AACDN,IAAAA,KAAK,CAACI,IAAD,CAAL,GAAcE,KAAd;AACD;;AAEDQ,EAAAA,QAAQ,CAACV,IAAD,EAAO;AACb,WAAO,KAAKX,MAAL,CAAYO,KAAZ,CAAkBI,IAAlB,CAAP;AACD,GA5DW,CA8DZ;;;AAEAQ,EAAAA,YAAY,CAACG,IAAD,EAAO;AACjB,QAAIA,IAAI,IAAKzB,WAAW,CAAC0B,OAAZ,CAAoBD,IAAI,CAACtB,MAAL,CAAYwB,IAAhC,IAAwC,CAAC,CAAtD,EAA0D;AACxD,UAAIF,IAAI,CAACZ,GAAL,CAAS,QAAT,MAAuB,IAA3B,EAAiC;AAC/BY,QAAAA,IAAI,GAAGG,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBJ,IAAlB,CAAP;AACD;;AACDA,MAAAA,IAAI,CAACV,GAAL,CAAS,QAAT,EAAmB,KAAKF,GAAL,CAAS,QAAT,CAAnB;AACAY,MAAAA,IAAI,CAACV,GAAL,CAAS,SAAT,EAAoB,KAAKF,GAAL,CAAS,SAAT,CAApB;AACA,aAAOY,IAAP;AACD;;AACD,WAAO,IAAP;AACD;;AAEDN,EAAAA,IAAI,CAACL,IAAD,EAAOE,KAAP,EAAc;AAChB,UAAMc,IAAI,GAAG,IAAb;AACA,QAAIA,IAAI,CAACjB,GAAL,CAAS,WAAT,CAAJ,EAA2B,OAAO,IAAP;AAC3B,UAAMkB,YAAY,GAAGC,SAAS,CAACC,MAA/B;;AACA,QAAIF,YAAY,KAAK,CAArB,EAAwB;AACtB,aAAOD,IAAI,CAAC3B,MAAL,CAAYO,KAAnB;AACD;;AAED,QAAItB,IAAI,CAAC8C,QAAL,CAAcpB,IAAd,CAAJ,EAAyB;AACvB,WAAKX,MAAL,CAAYgC,IAAZ,GAAmB,IAAnB;;AACA,WAAK,MAAMC,CAAX,IAAgBtB,IAAhB,EAAsB;AACpBgB,QAAAA,IAAI,CAACT,QAAL,CAAce,CAAd,EAAiBtB,IAAI,CAACsB,CAAD,CAArB;AACD;;AACD,UAAIN,IAAI,CAACO,cAAT,EAAyB;AACvBP,QAAAA,IAAI,CAACO,cAAL;AACD;;AACD,aAAOP,IAAP;AACD;;AACD,QAAIC,YAAY,KAAK,CAArB,EAAwB;AACtB,WAAK5B,MAAL,CAAYgC,IAAZ,GAAmB,IAAnB;;AACAL,MAAAA,IAAI,CAACT,QAAL,CAAcP,IAAd,EAAoBE,KAApB;;AACA,UAAIc,IAAI,CAACO,cAAT,EAAyB;AACvBP,QAAAA,IAAI,CAACO,cAAL;AACD;;AACD,aAAOP,IAAP;AACD;;AACD,WAAOA,IAAI,CAACN,QAAL,CAAcV,IAAd,CAAP;AACD;;AAEDwB,EAAAA,SAAS,GAAG;AACV,WAAO,KAAKzB,GAAL,CAAS,QAAT,CAAP;AACD;;AAED0B,EAAAA,IAAI,CAACC,OAAD,EAAU;AACZ,QAAI,KAAK3B,GAAL,CAAS,WAAT,CAAJ,EAA2B;AACzB;AACD;;AACD,QAAI,KAAKA,GAAL,CAAS,SAAT,CAAJ,EAAyB;AACvB,WAAK4B,UAAL,CAAgBD,OAAhB;AACA,WAAKE,SAAL,CAAeF,OAAf;AACA,WAAKG,cAAL,CAAoBH,OAApB;AACD;AACF;;AAEDC,EAAAA,UAAU,CAACD,OAAD,EAAU;AAClB,UAAMf,IAAI,GAAG,KAAKtB,MAAL,CAAYO,KAAZ,CAAkBe,IAA/B;AACAe,IAAAA,OAAO,CAACI,IAAR;;AACA,QAAInB,IAAJ,EAAU;AACRA,MAAAA,IAAI,CAACoB,cAAL,CAAoBL,OAApB;AACAf,MAAAA,IAAI,CAACqB,UAAL,CAAgBN,OAAhB;AACAA,MAAAA,OAAO,CAACf,IAAR;AACD;;AACD,SAAKsB,YAAL,CAAkBP,OAAlB;AACA,SAAKK,cAAL,CAAoBL,OAApB;AACD;;AAEDG,EAAAA,cAAc,CAACH,OAAD,EAAU;AACtBA,IAAAA,OAAO,CAACQ,OAAR;AACD;;AAEDD,EAAAA,YAAY,CAACP,OAAD,EAAU;AACpB,UAAMS,OAAO,GAAG,KAAK9C,MAAL,CAAYO,KAA5B;;AACA,QAAI,CAAC,KAAKP,MAAL,CAAYc,OAAjB,EAA0B;AACxB,WAAK,MAAMmB,CAAX,IAAgBa,OAAhB,EAAyB;AACvB,YAAIlD,WAAW,CAAC2B,OAAZ,CAAoBU,CAApB,IAAyB,CAAC,CAA9B,EAAiC;AAC/B,cAAIc,CAAC,GAAGD,OAAO,CAACb,CAAD,CAAf;;AACA,cAAIA,CAAC,KAAK,WAAN,IAAqBA,CAAC,KAAK,aAA/B,EAA8C;AAC5Cc,YAAAA,CAAC,GAAG1D,SAAS,CAAC2D,UAAV,CAAqBD,CAArB,EAAwB,IAAxB,EAA8BV,OAA9B,CAAJ;AACD;;AACD,cAAIJ,CAAC,KAAK,UAAN,IAAoBI,OAAO,CAACY,WAA5B,IAA2ChE,IAAI,CAACiE,OAAL,CAAaH,CAAb,CAA/C,EAAgE;AAC9DV,YAAAA,OAAO,CAACY,WAAR,CAAoBF,CAApB;AACD,WAFD,MAEO;AACLV,YAAAA,OAAO,CAACJ,CAAD,CAAP,GAAac,CAAb;AACD;AACF;AACF;AACF;AACF;;AAEDI,EAAAA,OAAO,GAAG;AACR,WAAO,KAAKzC,GAAL,CAAS,SAAT,KAAuB,KAAKV,MAAL,CAAYO,KAAZ,CAAkB6C,SAAhD;AACD;;AAEDC,EAAAA,SAAS,GAAG;AACV,WAAO,KAAK3C,GAAL,CAAS,WAAT,KAAyB,KAAKV,MAAL,CAAYO,KAAZ,CAAkB+C,WAAlD;AACD;;AAEDf,EAAAA,SAAS;AAAC;AAAe,GAExB;;AAEDgB,EAAAA,IAAI,GAAG;AACL,SAAK3C,GAAL,CAAS,SAAT,EAAoB,IAApB;AACA,WAAO,IAAP;AACD;;AAED4C,EAAAA,IAAI,GAAG;AACL,SAAK5C,GAAL,CAAS,SAAT,EAAoB,KAApB;AACA,WAAO,IAAP;AACD;;AAED6C,EAAAA,SAAS,GAAG;AACV,WAAO,KAAK/C,GAAL,CAAS,SAAT,CAAP;AACD;;AAEDgD,EAAAA,iBAAiB,GAAG;AAClB,UAAMC,MAAM,GAAG,KAAKjD,GAAL,CAAS,QAAT,CAAf;;AACA,QAAIiD,MAAJ,EAAY;AACV,YAAMC,QAAQ,GAAGD,MAAM,CAACjD,GAAP,CAAW,UAAX,CAAjB;AACAzB,MAAAA,IAAI,CAAC4E,KAAL,CAAWC,MAAX,CAAkBF,QAAlB,EAA4B,IAA5B;AACD;;AAED,WAAO,IAAP;AACD;;AAEDE,EAAAA,MAAM,CAACC,OAAD,EAAU;AACd,QAAIA,OAAJ,EAAa;AACX,WAAKA,OAAL;AACD,KAFD,MAEO;AACL,WAAKL,iBAAL;AACD;AACF;;AAEDK,EAAAA,OAAO,GAAG;AACR,UAAM5D,SAAS,GAAG,KAAKO,GAAL,CAAS,WAAT,CAAlB;;AAEA,QAAIP,SAAJ,EAAe;AACb,aAAO,IAAP;AACD;;AAED,SAAKuD,iBAAL;;AAEA,SAAK1D,MAAL,GAAc,EAAd;AACA,SAAKY,GAAL,CAAS,WAAT,EAAsB,IAAtB;AACD;;AAEDoD,EAAAA,OAAO,GAAG;AACR,WAAO;AACLC,MAAAA,IAAI,EAAE,CADD;AAELC,MAAAA,IAAI,EAAE,CAFD;AAGLC,MAAAA,IAAI,EAAE,CAHD;AAILC,MAAAA,IAAI,EAAE,CAJD;AAKLC,MAAAA,KAAK,EAAE,CALF;AAMLC,MAAAA,MAAM,EAAE;AANH,KAAP;AAQD;;AAED7D,EAAAA,aAAa,GAAG;AACd,UAAMF,KAAK,GAAG,KAAKP,MAAL,CAAYO,KAAZ,IAAqB,EAAnC;;AACA,QAAI,CAACA,KAAK,CAACgE,MAAX,EAAmB;AACjBhE,MAAAA,KAAK,CAACgE,MAAN,GAAe,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,EAAW,CAAX,EAAc,CAAd,EAAiB,CAAjB,CAAf;AACD;;AACD,SAAKvE,MAAL,CAAYO,KAAZ,GAAoBA,KAApB;AACD;;AAEDiE,EAAAA,SAAS,GAAG;AACV,WAAO,KAAKxE,MAAL,CAAYO,KAAZ,CAAkBgE,MAAzB;AACD;;AAEDE,EAAAA,SAAS,CAAClF,CAAD,EAAI;AACX,SAAKS,MAAL,CAAYO,KAAZ,CAAkBgE,MAAlB,GAA2B,CAAEhF,CAAC,CAAC,CAAD,CAAH,EAAQA,CAAC,CAAC,CAAD,CAAT,EAAcA,CAAC,CAAC,CAAD,CAAf,EAAoBA,CAAC,CAAC,CAAD,CAArB,EAA0BA,CAAC,CAAC,CAAD,CAA3B,EAAgCA,CAAC,CAAC,CAAD,CAAjC,CAA3B;AACD;;AAEDmF,EAAAA,SAAS,CAACC,OAAD,EAAU;AACjB,UAAMJ,MAAM,GAAG,KAAKvE,MAAL,CAAYO,KAAZ,CAAkBgE,MAAjC;AACA,SAAKvE,MAAL,CAAYO,KAAZ,CAAkBgE,MAAlB,GAA2BpF,UAAU,CAACuF,SAAX,CAAqBH,MAArB,EAA6BI,OAA7B,CAA3B;AACA,WAAO,IAAP;AACD;;AAEDC,EAAAA,YAAY,CAACD,OAAD,EAAU;AACpB,SAAK3E,MAAL,CAAYO,KAAZ,CAAkBgE,MAAlB,GAA2B,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,EAAW,CAAX,EAAc,CAAd,EAAiB,CAAjB,CAA3B;AACA,WAAO,KAAKG,SAAL,CAAeC,OAAf,CAAP;AACD;;AAEDE,EAAAA,SAAS,CAACC,CAAD,EAAIC,CAAJ,EAAO;AACd,UAAMR,MAAM,GAAG,KAAKvE,MAAL,CAAYO,KAAZ,CAAkBgE,MAAjC;AACApF,IAAAA,UAAU,CAAC0F,SAAX,CAAqBN,MAArB,EAA6BA,MAA7B,EAAqC,CAAEO,CAAF,EAAKC,CAAL,CAArC;AACD;;AAEDC,EAAAA,MAAM,CAACC,GAAD,EAAM;AACV,UAAMV,MAAM,GAAG,KAAKvE,MAAL,CAAYO,KAAZ,CAAkBgE,MAAjC;AACApF,IAAAA,UAAU,CAAC6F,MAAX,CAAkBT,MAAlB,EAA0BA,MAA1B,EAAkCU,GAAlC;AACD;;AAEDC,EAAAA,KAAK,CAACC,EAAD,EAAKC,EAAL,EAAS;AACZ,UAAMb,MAAM,GAAG,KAAKvE,MAAL,CAAYO,KAAZ,CAAkBgE,MAAjC;AACApF,IAAAA,UAAU,CAAC+F,KAAX,CAAiBX,MAAjB,EAAyBA,MAAzB,EAAiC,CAAEY,EAAF,EAAMC,EAAN,CAAjC;AACD;;AAEDC,EAAAA,MAAM,CAACP,CAAD,EAAIC,CAAJ,EAAO;AACX,UAAMO,EAAE,GAAG,KAAKtF,MAAL,CAAY8E,CAAZ,IAAiB,CAA5B;AACA,UAAMS,EAAE,GAAG,KAAKvF,MAAL,CAAY+E,CAAZ,IAAiB,CAA5B;AACA,SAAKF,SAAL,CAAeC,CAAC,GAAGQ,EAAnB,EAAuBP,CAAC,GAAGQ,EAA3B;AACA,SAAK3E,GAAL,CAAS,GAAT,EAAckE,CAAd;AACA,SAAKlE,GAAL,CAAS,GAAT,EAAcmE,CAAd;AACD;;AAEDS,EAAAA,KAAK,CAACzC,CAAD,EAAI;AACP,UAAMxD,CAAC,GAAG,KAAKS,MAAL,CAAYO,KAAZ,CAAkBgE,MAA5B;AACAnF,IAAAA,OAAO,CAACqG,cAAR,CAAuB1C,CAAvB,EAA0BA,CAA1B,EAA6BxD,CAA7B;AACA,WAAO,IAAP;AACD;;AAEDmD,EAAAA,cAAc,CAACL,OAAD,EAAU;AACtB,UAAMqD,EAAE,GAAG,KAAK1F,MAAL,CAAYO,KAAZ,CAAkBgE,MAA7B;;AACA,QAAI,CAACjF,WAAW,CAACoG,EAAD,CAAhB,EAAsB;AACpBrD,MAAAA,OAAO,CAACqC,SAAR,CAAkBgB,EAAE,CAAC,CAAD,CAApB,EAAyBA,EAAE,CAAC,CAAD,CAA3B,EAAgCA,EAAE,CAAC,CAAD,CAAlC,EAAuCA,EAAE,CAAC,CAAD,CAAzC,EAA8CA,EAAE,CAAC,CAAD,CAAhD,EAAqDA,EAAE,CAAC,CAAD,CAAvD;AACD;AACF;;AAEDC,EAAAA,WAAW,GAAG;AACZ,WAAO,KAAKjF,GAAL,CAAS,WAAT,CAAP;AACD;;AAhSW;;AAmSdkF,MAAM,CAACC,OAAP,GAAiB/F,OAAjB","sourcesContent":["const Util = require('../util/common');\nconst MatrixUtil = require('./util/matrix');\nconst Vector2 = require('./util/vector2');\nconst StyleUtil = require('./util/style-parse');\n\nfunction isUnchanged(m) {\n  return m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 1 && m[4] === 0 && m[5] === 0;\n}\n\nconst ALIAS_ATTRS_MAP = {\n  stroke: 'strokeStyle',\n  fill: 'fillStyle',\n  opacity: 'globalAlpha'\n};\n\nconst SHAPE_ATTRS = [\n  'fillStyle',\n  'font',\n  'globalAlpha',\n  'lineCap',\n  'lineWidth',\n  'lineJoin',\n  'miterLimit',\n  'shadowBlur',\n  'shadowColor',\n  'shadowOffsetX',\n  'shadowOffsetY',\n  'strokeStyle',\n  'textAlign',\n  'textBaseline',\n  'lineDash',\n  'shadow' // 兼容支付宝小程序\n];\n\nconst CLIP_SHAPES = [ 'circle', 'sector', 'polygon', 'rect', 'polyline' ];\n\nclass Element {\n  _initProperties() {\n    this._attrs = {\n      zIndex: 0,\n      visible: true,\n      destroyed: false\n    };\n  }\n\n  constructor(cfg) {\n    this._initProperties();\n    Util.mix(this._attrs, cfg);\n\n    const attrs = this._attrs.attrs;\n    if (attrs) {\n      this.initAttrs(attrs);\n    }\n\n    this.initTransform();\n  }\n\n  get(name) {\n    return this._attrs[name];\n  }\n\n  set(name, value) {\n    this._attrs[name] = value;\n  }\n\n  isGroup() {\n    return this.get('isGroup');\n  }\n\n  isShape() {\n    return this.get('isShape');\n  }\n\n  initAttrs(attrs) {\n    this.attr(Util.mix(this.getDefaultAttrs(), attrs));\n  }\n\n  getDefaultAttrs() {\n    return {};\n  }\n\n  _setAttr(name, value) {\n    const attrs = this._attrs.attrs;\n    if (name === 'clip') {\n      value = this._setAttrClip(value);\n    } else {\n      const alias = ALIAS_ATTRS_MAP[name];\n      if (alias) {\n        attrs[alias] = value;\n      }\n    }\n    attrs[name] = value;\n  }\n\n  _getAttr(name) {\n    return this._attrs.attrs[name];\n  }\n\n  // _afterAttrsSet() {}\n\n  _setAttrClip(clip) {\n    if (clip && (CLIP_SHAPES.indexOf(clip._attrs.type) > -1)) {\n      if (clip.get('canvas') === null) {\n        clip = Object.assign({}, clip);\n      }\n      clip.set('parent', this.get('parent'));\n      clip.set('context', this.get('context'));\n      return clip;\n    }\n    return null;\n  }\n\n  attr(name, value) {\n    const self = this;\n    if (self.get('destroyed')) return null;\n    const argumentsLen = arguments.length;\n    if (argumentsLen === 0) {\n      return self._attrs.attrs;\n    }\n\n    if (Util.isObject(name)) {\n      this._attrs.bbox = null;\n      for (const k in name) {\n        self._setAttr(k, name[k]);\n      }\n      if (self._afterAttrsSet) {\n        self._afterAttrsSet();\n      }\n      return self;\n    }\n    if (argumentsLen === 2) {\n      this._attrs.bbox = null;\n      self._setAttr(name, value);\n      if (self._afterAttrsSet) {\n        self._afterAttrsSet();\n      }\n      return self;\n    }\n    return self._getAttr(name);\n  }\n\n  getParent() {\n    return this.get('parent');\n  }\n\n  draw(context) {\n    if (this.get('destroyed')) {\n      return;\n    }\n    if (this.get('visible')) {\n      this.setContext(context);\n      this.drawInner(context);\n      this.restoreContext(context);\n    }\n  }\n\n  setContext(context) {\n    const clip = this._attrs.attrs.clip;\n    context.save();\n    if (clip) {\n      clip.resetTransform(context);\n      clip.createPath(context);\n      context.clip();\n    }\n    this.resetContext(context);\n    this.resetTransform(context);\n  }\n\n  restoreContext(context) {\n    context.restore();\n  }\n\n  resetContext(context) {\n    const elAttrs = this._attrs.attrs;\n    if (!this._attrs.isGroup) {\n      for (const k in elAttrs) {\n        if (SHAPE_ATTRS.indexOf(k) > -1) {\n          let v = elAttrs[k];\n          if (k === 'fillStyle' || k === 'strokeStyle') {\n            v = StyleUtil.parseStyle(v, this, context);\n          }\n          if (k === 'lineDash' && context.setLineDash && Util.isArray(v)) {\n            context.setLineDash(v);\n          } else {\n            context[k] = v;\n          }\n        }\n      }\n    }\n  }\n\n  hasFill() {\n    return this.get('canFill') && this._attrs.attrs.fillStyle;\n  }\n\n  hasStroke() {\n    return this.get('canStroke') && this._attrs.attrs.strokeStyle;\n  }\n\n  drawInner(/* context */) {\n\n  }\n\n  show() {\n    this.set('visible', true);\n    return this;\n  }\n\n  hide() {\n    this.set('visible', false);\n    return this;\n  }\n\n  isVisible() {\n    return this.get('visible');\n  }\n\n  _removeFromParent() {\n    const parent = this.get('parent');\n    if (parent) {\n      const children = parent.get('children');\n      Util.Array.remove(children, this);\n    }\n\n    return this;\n  }\n\n  remove(destroy) {\n    if (destroy) {\n      this.destroy();\n    } else {\n      this._removeFromParent();\n    }\n  }\n\n  destroy() {\n    const destroyed = this.get('destroyed');\n\n    if (destroyed) {\n      return null;\n    }\n\n    this._removeFromParent();\n\n    this._attrs = {};\n    this.set('destroyed', true);\n  }\n\n  getBBox() {\n    return {\n      minX: 0,\n      maxX: 0,\n      minY: 0,\n      maxY: 0,\n      width: 0,\n      height: 0\n    };\n  }\n\n  initTransform() {\n    const attrs = this._attrs.attrs || {};\n    if (!attrs.matrix) {\n      attrs.matrix = [ 1, 0, 0, 1, 0, 0 ];\n    }\n    this._attrs.attrs = attrs;\n  }\n\n  getMatrix() {\n    return this._attrs.attrs.matrix;\n  }\n\n  setMatrix(m) {\n    this._attrs.attrs.matrix = [ m[0], m[1], m[2], m[3], m[4], m[5] ];\n  }\n\n  transform(actions) {\n    const matrix = this._attrs.attrs.matrix;\n    this._attrs.attrs.matrix = MatrixUtil.transform(matrix, actions);\n    return this;\n  }\n\n  setTransform(actions) {\n    this._attrs.attrs.matrix = [ 1, 0, 0, 1, 0, 0 ];\n    return this.transform(actions);\n  }\n\n  translate(x, y) {\n    const matrix = this._attrs.attrs.matrix;\n    MatrixUtil.translate(matrix, matrix, [ x, y ]);\n  }\n\n  rotate(rad) {\n    const matrix = this._attrs.attrs.matrix;\n    MatrixUtil.rotate(matrix, matrix, rad);\n  }\n\n  scale(sx, sy) {\n    const matrix = this._attrs.attrs.matrix;\n    MatrixUtil.scale(matrix, matrix, [ sx, sy ]);\n  }\n\n  moveTo(x, y) {\n    const cx = this._attrs.x || 0;\n    const cy = this._attrs.y || 0;\n    this.translate(x - cx, y - cy);\n    this.set('x', x);\n    this.set('y', y);\n  }\n\n  apply(v) {\n    const m = this._attrs.attrs.matrix;\n    Vector2.transformMat2d(v, v, m);\n    return this;\n  }\n\n  resetTransform(context) {\n    const mo = this._attrs.attrs.matrix;\n    if (!isUnchanged(mo)) {\n      context.transform(mo[0], mo[1], mo[2], mo[3], mo[4], mo[5]);\n    }\n  }\n\n  isDestroyed() {\n    return this.get('destroyed');\n  }\n}\n\nmodule.exports = Element;\n"]},"metadata":{},"sourceType":"script"}